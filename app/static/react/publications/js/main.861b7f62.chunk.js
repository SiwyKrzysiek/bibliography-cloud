(this["webpackJsonpreact-publications"]=this["webpackJsonpreact-publications"]||[]).push([[0],{24:function(e,t,a){e.exports=a(37)},29:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(17),s=a.n(c),i=(a(29),a(1)),l=a.n(i),o=a(18),u=a(22),m=a(19),p=a(23),b=a(7),f=a(6),d=Object(f.g)((function(e){var t=e.label,a=e.publications,n=e.match,c=e.refreshPublications;return r.a.createElement("section",{className:"container"},r.a.createElement("h2",null,t),r.a.createElement("ul",{className:"list-group"},a.map((function(e){var t=e.links.find((function(e){return"self"===e.rel})),a=e.links.find((function(e){return"delete"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.title),r.a.createElement("div",{className:"buttons"},t&&r.a.createElement(b.b,{to:"".concat(n.url,"/").concat(e.id)},r.a.createElement("button",{className:"btn btn-info mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-info-circle"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Szczeg\xf3\u0142y"))),a&&r.a.createElement("button",{className:"btn btn-danger mr-2",onClick:function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(fetch(a.href,{method:"DELETE"}));case 2:c();case 3:case"end":return e.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Usu\u0144"))))}))))})),h=a(10),E=a(14),g=Object(f.g)((function(e){var t=e.createMode,a=e.publication,c=e.history,s=e.refreshPublications,i=e.globalState;t&&(a={owner:i.login,title:"",pageCount:null,publicationYear:null,attachments:[],shareList:[]});var o=a;console.log(o);var u=Object(n.useState)(!!t),m=Object(E.a)(u,2),p=m[0],b=m[1],f=Object(n.useState)(o),d=Object(E.a)(f,2),g=d[0],w=d[1],N="form-control"+(p?"":" form-control-plaintext"),y=function(e){return e.title.length>0&&e.pageCount>0&&e.publicationYear>0};return r.a.createElement("section",{className:"container mt-3"},r.a.createElement("form",null,r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"title"},"Tytu\u0142"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:N,name:"title",type:"text",readOnly:!p,value:g.title,onChange:function(e){w(Object(h.a)({},g,{title:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"pageCount"},"Liczba stron"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:N,readOnly:!p,name:"pageCount",type:"number",min:0,value:g.pageCount,onChange:function(e){w(Object(h.a)({},g,{pageCount:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"publicationYear"},"Rok wydania"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:N,readOnly:!p,name:"publicationYer",type:"number",min:1200,max:2200,value:g.publicationYear,onChange:function(e){w(Object(h.a)({},g,{publicationYear:e.target.value}))}}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"font-weight-bolder"},"Za\u0142\u0105czone pliki"),r.a.createElement("ul",{className:"list-group"},g.attachments.map((function(e){var t=e.links.find((function(e){return"download"===e.rel})),a=e.links.find((function(e){return"detach"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.fileName),r.a.createElement("div",{className:"buttons"},t&&r.a.createElement("a",{href:t.href,className:"btn btn-primary mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-cloud-download-alt"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Pobierz")),a&&r.a.createElement("button",{onClick:function(){return function(e){var t,a;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=g.attachments.find((function(t){return t.id===e})),a=t.links.find((function(e){return"detach"===e.rel})).href,n.next=4,l.a.awrap(fetch(a,{method:"DELETE"}));case 4:if(n.sent.ok){n.next=8;break}return alert("Nie uda\u0142o si\u0119 od\u0142\u0105czy\u0107 pliku"),n.abrupt("return");case 8:w(Object(h.a)({},g,{attachments:g.attachments.filter((function(t){return t.id!==e}))})),s();case 10:case"end":return n.stop()}}))}(e.id)},className:"btn btn-warning mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-unlink"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Od\u0142\u0105cz"))))})))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-group d-flex justify-content-end"},p&&!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){var e;return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(y(g)){t.next=3;break}return alert("Niepoprawne dane"),t.abrupt("return");case 3:return e=g.links.find((function(e){return"self"===e.rel})),t.next=6,l.a.awrap(fetch(e.href,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}));case 6:if(t.sent.ok){t.next=10;break}return alert("Nie uda\u0142o si\u0119\xa0zapisa\u0107 zmian"),t.abrupt("return");case 10:s(),c.push("/publications");case 12:case"end":return t.stop()}}))}},"Zapisz"),r.a.createElement("button",{className:"btn btn-danger ml-2",type:"button",onClick:function(){w(o),b(!1)}},"Anuluj zmiany")),!p&&r.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return b(!0)}},"Edytuj"),t&&r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){var e,t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(y(g)){a.next=3;break}return alert("Niepoprawne dane"),a.abrupt("return");case 3:return e=i.urls.publicationsApi,t=(t=e+i.actions["publication.create"].href).replace("{user}",i.login),a.next=8,l.a.awrap(fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}));case 8:if(a.sent.ok){a.next=12;break}return alert("Nie uda\u0142o si\u0119\xa0utworzy\u0107 publikacji"),a.abrupt("return");case 12:s(),c.push("/publications");case 14:case"end":return a.stop()}}))}},"Utw\xf3rz pulikacj\u0119"))))})),w=(a(36),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).getActionList=function(){var e,t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(fetch(a.props.urls.publicationsApi));case 2:return e=n.sent,n.next=5,l.a.awrap(e.json());case 5:t=n.sent,a.setState({actions:t._links});case 7:case"end":return n.stop()}}))},a.getCurrentUserLogin=function(){var e,t,n;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=new URL("api/login",a.props.urls.clientBase),r.next=3,l.a.awrap(fetch(e));case 3:return t=r.sent,r.next=6,l.a.awrap(t.text());case 6:return n=r.sent,a.setState({login:n}),r.abrupt("return",n);case 9:case"end":return r.stop()}}))},a.getPublications=function(){var e,t,n,r;return l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(a.state.actions["publications.list"]){c.next=2;break}return c.abrupt("return");case 2:return a.setState({loadingPublications:!0}),e=(e=a.state.actions["publications.list"].href).replace("{user}",a.state.login),t=new URL(e,a.props.urls.publicationsApi),c.next=8,l.a.awrap(fetch(t));case 8:return n=c.sent,c.next=11,l.a.awrap(n.json());case 11:r=c.sent,a.setState({publications:r,loadingPublications:!1});case 13:case"end":return c.stop()}}))},a.getUserFiles=function(){var e,t,n,r;return l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return e=new URL("api/jwt/listFiles",a.props.urls.clientBase),c.next=3,l.a.awrap(fetch(e));case 3:return t=c.sent,c.next=6,l.a.awrap(t.json());case 6:return n=c.sent,r=n.token,(e=new URL("/files",a.props.urls.filesApi)).searchParams.set("user",a.state.login),e.searchParams.set("token",r),c.next=13,l.a.awrap(fetch(e));case 13:return t=c.sent,c.next=16,l.a.awrap(t.json());case 16:if(n=c.sent,t.ok){c.next=20;break}return alert("Nie uda\u0142o si\u0119 pobra\u0107 listy Twoich plik\xf3w"),c.abrupt("return");case 20:a.setState({userFiles:n});case 21:case"end":return c.stop()}}))},a.componentDidMount=function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(a.getCurrentUserLogin());case 2:return e.next=4,l.a.awrap(a.getActionList());case 4:a.getPublications(),a.getUserFiles();case 6:case"end":return e.stop()}}))},a.render=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(b.a,null,r.a.createElement(f.b,{path:"/publications",render:function(e){var t=e.match.isExact;return r.a.createElement("section",{className:"container intro d-flex"},!t&&r.a.createElement(b.b,{to:"/publications",onClick:a.getPublications},r.a.createElement("button",{className:"btn btn-warning h-100",style:{width:"6.5ch"}},r.a.createElement("i",{className:"fas fa-chevron-left"}))),r.a.createElement("h1",{className:"mt-2 text-center",style:{flexGrow:1}},"Publikacje"))}}),r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/publications"},r.a.createElement(d,{label:"Twoje publikacje",publications:a.state.publications,refreshPublications:a.getPublications}),r.a.createElement("section",{className:"container"},r.a.createElement("hr",null),a.state.actions["publication.create"]&&r.a.createElement(b.b,{to:"/publications/create"},r.a.createElement("button",{type:"button",className:"btn btn-primary"},"Nowa publikacja")))),r.a.createElement(f.b,{path:"/publications/create"},r.a.createElement(g,{createMode:!0,refreshPublications:a.getPublications,globalState:a.state})),r.a.createElement(f.b,{path:"/publications/:publicationId",render:function(e){var t=a.state.publications.find((function(t){return t.id==e.match.params.publicationId}));return t?r.a.createElement(g,{publication:t,refreshPublications:a.getPublications,globalState:a.state}):r.a.createElement(f.a,{to:"/publications"})}}))))},a.state={login:null,loadingPublications:!1,publications:[],userFiles:[],actions:{},urls:e.urls},a}return Object(p.a)(t,e),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var N={clientBase:document.getElementById("app-url").innerText,filesApi:document.getElementById("file-api-url").innerText,publicationsApi:document.getElementById("publications-api-url").innerText};s.a.render(r.a.createElement(w,{urls:N}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[24,1,2]]]);
//# sourceMappingURL=main.861b7f62.chunk.js.map