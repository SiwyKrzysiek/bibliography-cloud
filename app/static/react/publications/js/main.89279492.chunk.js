(this["webpackJsonpreact-publications"]=this["webpackJsonpreact-publications"]||[]).push([[0],{30:function(e,t,a){e.exports=a(43)},35:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(17),s=a.n(c),i=(a(35),a(4)),l=a.n(i),o=a(5),u=a(6),m=a(7),p=a(8),f=a(18),b=a(15),d=Object(b.g)((function(e){var t=e.label,a=e.publications,n=e.match,c=e.refreshPublications;return r.a.createElement("section",{className:"container"},r.a.createElement("h2",null,t),r.a.createElement("ul",{className:"list-group"},a.map((function(e){var t=e.links.find((function(e){return"self"===e.rel})),a=e.links.find((function(e){return"delete"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.title),r.a.createElement("div",{className:"buttons"},t&&r.a.createElement(f.b,{to:"".concat(n.url,"/").concat(e.id)},r.a.createElement("button",{className:"btn btn-info mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-info-circle"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Szczeg\xf3\u0142y"))),a&&r.a.createElement("button",{className:"btn btn-danger mr-2",onClick:function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(fetch(a.href,{method:"DELETE"}));case 2:c();case 3:case"end":return e.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Usu\u0144"))))}))))})),h=(a(19),a(16)),E=a(21),g=a(29),N=Object(b.g)((function(e){var t=e.createMode,a=e.publication,c=e.history,s=e.refreshPublications,i=e.globalState;t&&(a={owner:i.login,title:"",pageCount:null,publicationYear:null,attachments:[],shareList:[],links:[]});var o=a,u=Object(n.useState)(!!t),m=Object(E.a)(u,2),p=m[0],f=m[1],b=Object(n.useState)(o),d=Object(E.a)(b,2),N=d[0],w=d[1],v=Object(n.useState)([]),x=Object(E.a)(v,2),y=x[0],k=x[1],j="form-control"+(p?"":" form-control-plaintext"),O=N.links.find((function(e){return"attachFile"===e.rel}));console.log(N);var C=function(e){return e.title.length>0&&e.pageCount>0&&e.publicationYear>0},P=function(e){var t=Math.max(N.attachments.map((function(e){return e.id})))+1,a=e.map((function(e){return{id:t++,userName:i.login,fileName:e,links:[{rel:"detach",href:"createMode"}]}}));w(Object(h.a)({},N,{attachments:N.attachments.concat(a)}))};return r.a.createElement("section",{className:"container mt-3"},r.a.createElement("form",null,r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"title"},"Tytu\u0142"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:j,name:"title",type:"text",readOnly:!p,value:N.title,onChange:function(e){w(Object(h.a)({},N,{title:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"pageCount"},"Liczba stron"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:j,readOnly:!p,name:"pageCount",type:"number",min:0,value:N.pageCount,onChange:function(e){w(Object(h.a)({},N,{pageCount:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"publicationYear"},"Rok wydania"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:j,readOnly:!p,name:"publicationYer",type:"number",min:1200,max:2200,value:N.publicationYear,onChange:function(e){w(Object(h.a)({},N,{publicationYear:e.target.value}))}}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"font-weight-bolder"},"Za\u0142\u0105czone pliki"),r.a.createElement("ul",{className:"list-group"},N.attachments.map((function(e){var a=e.links.find((function(e){return"download"===e.rel})),n=e.links.find((function(e){return"detach"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.fileName),r.a.createElement("div",{className:"buttons"},a&&r.a.createElement("a",{href:a.href,className:"btn btn-primary mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-cloud-download-alt"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Pobierz")),n&&p&&r.a.createElement("button",{onClick:function(){return function(e){var a,n;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=10;break}return a=N.attachments.find((function(t){return t.id===e})),n=a.links.find((function(e){return"detach"===e.rel})).href,r.next=5,l.a.awrap(fetch(n,{method:"DELETE"}));case 5:if(r.sent.ok){r.next=9;break}return alert("Nie uda\u0142o si\u0119 od\u0142\u0105czy\u0107 pliku"),r.abrupt("return");case 9:s();case 10:w(Object(h.a)({},N,{attachments:N.attachments.filter((function(t){return t.id!==e}))}));case 11:case"end":return r.stop()}}))}(e.id)},className:"btn btn-warning mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-unlink"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Od\u0142\u0105cz"))))})))),p&&(O||t)&&r.a.createElement("div",{className:"form-group "},r.a.createElement("label",{htmlFor:"attachments"},"Do\u0142\u0105cz pliki"),r.a.createElement("div",{className:"d-flex"},r.a.createElement(g.a,{isMulti:!0,value:y.map((function(e){return{value:e,label:e}})),name:"attachments",onChange:function(e){return k(e.map((function(e){return e.value})))},options:function(){var e=N.attachments.map((function(e){return e.fileName})),t=i.userFiles.map((function(e){return e.fileName}));return(t=t.filter((function(t){return!e.includes(t)}))).map((function(e){return{value:e,label:e}}))}(),className:"basic-multi-select flex-grow-1 mr-2",classNamePrefix:"select"}),r.a.createElement("button",{onClick:function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=4;break}return P(y),k([]),e.abrupt("return");case 4:case"end":return e.stop()}}))},className:"btn btn-success",type:"button"},r.a.createElement("i",{className:"fas fa-link"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Do\u0142\u0105cz")))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-group d-flex justify-content-end"},p&&!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){var e;return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(C(N)){t.next=3;break}return alert("Niepoprawne dane"),t.abrupt("return");case 3:return e=N.links.find((function(e){return"self"===e.rel})),t.next=6,l.a.awrap(fetch(e.href,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)}));case 6:if(t.sent.ok){t.next=10;break}return alert("Nie uda\u0142o si\u0119\xa0zapisa\u0107 zmian"),t.abrupt("return");case 10:s(),c.push("/publications");case 12:case"end":return t.stop()}}))}},"Zapisz"),r.a.createElement("button",{className:"btn btn-danger ml-2",type:"button",onClick:function(){w(o),f(!1)}},"Anuluj zmiany")),!p&&r.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:function(){return f(!0)}},"Edytuj"),t&&r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:function(){var e,t,a;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(C(N)){n.next=3;break}return alert("Niepoprawne dane"),n.abrupt("return");case 3:return e=i.urls.publicationsApi,t=(t=e+i.actions["publication.create"].href).replace("{user}",i.login),a=Object(h.a)({},N),p&&(a.attachments=a.attachments.map((function(e){return{userName:e.userName,fileName:e.fileName}}))),n.next=10,l.a.awrap(fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}));case 10:if(n.sent.ok){n.next=14;break}return alert("Nie uda\u0142o si\u0119\xa0utworzy\u0107 publikacji"),n.abrupt("return");case 14:return n.next=16,l.a.awrap(s());case 16:c.push("/publications");case 17:case"end":return n.stop()}}))}},"Utw\xf3rz pulikacj\u0119"))))})),w=(a(42),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).getActionList=function(){var e,t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(fetch(a.props.urls.publicationsApi));case 2:return e=n.sent,n.next=5,l.a.awrap(e.json());case 5:t=n.sent,a.setState({actions:t._links});case 7:case"end":return n.stop()}}))},a.getCurrentUserLogin=function(){var e,t,n;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=new URL("api/login",a.props.urls.clientBase),r.next=3,l.a.awrap(fetch(e));case 3:return t=r.sent,r.next=6,l.a.awrap(t.text());case 6:return n=r.sent,a.setState({login:n}),r.abrupt("return",n);case 9:case"end":return r.stop()}}))},a.getPublications=function(){var e,t,n,r;return l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(a.state.actions["publications.list"]){c.next=2;break}return c.abrupt("return");case 2:return a.setState({loadingPublications:!0}),e=(e=a.state.actions["publications.list"].href).replace("{user}",a.state.login),t=new URL(e,a.props.urls.publicationsApi),c.next=8,l.a.awrap(fetch(t));case 8:return n=c.sent,c.next=11,l.a.awrap(n.json());case 11:r=c.sent,a.setState({publications:r,loadingPublications:!1});case 13:case"end":return c.stop()}}))},a.getUserFiles=function(){var e,t,n,r;return l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return e=new URL("api/jwt/listFiles",a.props.urls.clientBase),c.next=3,l.a.awrap(fetch(e));case 3:return t=c.sent,c.next=6,l.a.awrap(t.json());case 6:return n=c.sent,r=n.token,(e=new URL("/files",a.props.urls.filesApi)).searchParams.set("user",a.state.login),e.searchParams.set("token",r),c.next=13,l.a.awrap(fetch(e));case 13:return t=c.sent,c.next=16,l.a.awrap(t.json());case 16:if(n=c.sent,t.ok){c.next=20;break}return alert("Nie uda\u0142o si\u0119 pobra\u0107 listy Twoich plik\xf3w"),c.abrupt("return");case 20:a.setState({userFiles:n});case 21:case"end":return c.stop()}}))},a.componentDidMount=function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(a.getCurrentUserLogin());case 2:return e.next=4,l.a.awrap(a.getActionList());case 4:a.getPublications(),a.getUserFiles();case 6:case"end":return e.stop()}}))},a.render=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(f.a,null,r.a.createElement(b.b,{path:"/publications",render:function(e){var t=e.match.isExact;return r.a.createElement("section",{className:"container intro d-flex"},!t&&r.a.createElement(f.b,{to:"/publications",onClick:a.getPublications},r.a.createElement("button",{className:"btn btn-warning h-100",style:{width:"6.5ch"}},r.a.createElement("i",{className:"fas fa-chevron-left"}))),r.a.createElement("h1",{className:"mt-2 text-center",style:{flexGrow:1}},"Publikacje"))}}),r.a.createElement(b.d,null,r.a.createElement(b.b,{exact:!0,path:"/publications"},r.a.createElement(d,{label:"Twoje publikacje",publications:a.state.publications,refreshPublications:a.getPublications}),r.a.createElement("section",{className:"container"},r.a.createElement("hr",null),a.state.actions["publication.create"]&&r.a.createElement(f.b,{to:"/publications/create"},r.a.createElement("button",{type:"button",className:"btn btn-primary"},"Nowa publikacja")))),r.a.createElement(b.b,{path:"/publications/create"},r.a.createElement(N,{createMode:!0,refreshPublications:a.getPublications,globalState:a.state})),r.a.createElement(b.b,{path:"/publications/:publicationId",render:function(e){var t=a.state.publications.find((function(t){return t.id==e.match.params.publicationId}));return t?r.a.createElement(N,{publication:t,refreshPublications:a.getPublications,globalState:a.state}):r.a.createElement(b.a,{to:"/publications"})}}))))},a.state={login:null,loadingPublications:!1,publications:[],userFiles:[],actions:{},urls:e.urls},a}return Object(p.a)(t,e),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var v={clientBase:document.getElementById("app-url").innerText,filesApi:document.getElementById("file-api-url").innerText,publicationsApi:document.getElementById("publications-api-url").innerText};s.a.render(r.a.createElement(w,{urls:v}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.89279492.chunk.js.map