(this["webpackJsonpreact-publications"]=this["webpackJsonpreact-publications"]||[]).push([[0],{33:function(e,t,a){e.exports=a(58)},38:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(17),s=a.n(c),l=(a(38),a(4)),i=a.n(l),o=a(5),u=a(6),m=a(7),p=a(8),b=a(18),f=a(15),d=Object(f.g)((function(e){var t=e.label,a=e.publications,n=e.match,c=e.refreshPublications;return r.a.createElement("section",{className:"container"},r.a.createElement("h2",null,t),r.a.createElement("ul",{className:"list-group"},a.map((function(e){var t=e.links.find((function(e){return"self"===e.rel})),a=e.links.find((function(e){return"delete"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.title),r.a.createElement("div",{className:"buttons"},t&&r.a.createElement(b.b,{to:"".concat(n.url,"/").concat(e.id)},r.a.createElement("button",{className:"btn btn-info mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-info-circle"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Szczeg\xf3\u0142y"))),a&&r.a.createElement("button",{className:"btn btn-danger mr-2",onClick:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(fetch(a.href,{method:"DELETE"}));case 2:c();case 3:case"end":return e.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Usu\u0144"))))}))))})),h=a(19),E=a(16),N=a(21),g=a(32),v=a(25),w=a.n(v),x=Object(f.g)((function(e){var t=e.createMode,a=e.publication,c=e.history,s=e.refreshPublications,l=e.globalState;t&&(a={owner:l.login,title:"",pageCount:null,publicationYear:null,attachments:[],shareList:[],links:[]});var o=a,u=Object(n.useState)(!!t),m=Object(N.a)(u,2),p=m[0],b=m[1],f=Object(n.useState)(o),d=Object(N.a)(f,2),v=d[0],x=d[1],y=Object(n.useState)([]),k=Object(N.a)(y,2),j=k[0],O=k[1],C=Object(n.useState)([]),P=Object(N.a)(C,2),S=P[0],z=P[1],F="form-control"+(p?"":" form-control-plaintext"),L=v.links.find((function(e){return"attachFile"===e.rel}));console.log(v);var T=function(e){return e.title.length>0&&e.pageCount>0&&e.publicationYear>0};return r.a.createElement("section",{className:"container mt-3"},r.a.createElement("form",null,r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"title"},"Tytu\u0142"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:F,name:"title",type:"text",readOnly:!p,value:v.title,onChange:function(e){x(Object(E.a)({},v,{title:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"pageCount"},"Liczba stron"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:F,readOnly:!p,name:"pageCount",type:"number",min:0,value:v.pageCount,onChange:function(e){x(Object(E.a)({},v,{pageCount:e.target.value}))}}))),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label",htmlFor:"publicationYear"},"Rok wydania"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{className:F,readOnly:!p,name:"publicationYer",type:"number",min:1200,max:2200,value:v.publicationYear,onChange:function(e){x(Object(E.a)({},v,{publicationYear:e.target.value}))}}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{className:"font-weight-bolder"},"Za\u0142\u0105czone pliki"),r.a.createElement("ul",{className:"list-group"},v.attachments.map((function(e){var t=e.links.find((function(e){return"download"===e.rel})),a=e.links.find((function(e){return"detach"===e.rel}));return r.a.createElement("li",{key:e.id,className:"list-group-item d-inline-flex align-items-center"},r.a.createElement("span",{className:"flex-grow-1"},e.fileName),r.a.createElement("div",{className:"buttons"},t&&r.a.createElement("a",{href:t.href,className:"btn btn-primary mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-cloud-download-alt"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Pobierz")),a&&p&&r.a.createElement("button",{onClick:function(){return t=e.id,i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:x(Object(E.a)({},v,{attachments:v.attachments.filter((function(e){return e.id!==t}))}));case 1:case"end":return e.stop()}}));var t},className:"btn btn-warning mr-2",type:"button"},r.a.createElement("i",{className:"fas fa-unlink"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Od\u0142\u0105cz"))))})))),p&&(L||t)&&r.a.createElement("div",{className:"form-group "},r.a.createElement("label",{htmlFor:"attachments"},"Do\u0142\u0105cz pliki"),r.a.createElement("div",{className:"d-flex"},r.a.createElement(g.a,{isMulti:!0,value:j.map((function(e){return{value:e,label:e}})),name:"attachments",onChange:function(e){return O(e.map((function(e){return e.value})))},options:function(){var e=v.attachments.map((function(e){return e.fileName})),t=l.userFiles.map((function(e){return e.fileName}));return(t=t.filter((function(t){return!e.includes(t)}))).map((function(e){return{value:e,label:e}}))}(),className:"basic-multi-select flex-grow-1 mr-2",classNamePrefix:"select"}),r.a.createElement("button",{onClick:function(){var e,t,a,n,r,c,s,o,u;return i.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:for(e=[],t=Object(h.a)(S),a=!0,n=!1,r=void 0,i.prev=5,c=j[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)o=s.value,u=Math.max.apply(Math,Object(h.a)(v.attachments.map((function(e){return e.id}))).concat(Object(h.a)(t)))+1,t.push(u),e.push({id:u,userName:l.login,fileName:o,links:[{rel:"detach",href:"NotYetSaved"}]});i.next=13;break;case 9:i.prev=9,i.t0=i.catch(5),n=!0,r=i.t0;case 13:i.prev=13,i.prev=14,a||null==c.return||c.return();case 16:if(i.prev=16,!n){i.next=19;break}throw r;case 19:return i.finish(16);case 20:return i.finish(13);case 21:z(t),x(Object(E.a)({},v,{attachments:v.attachments.concat(e)})),O([]);case 24:case"end":return i.stop()}}),null,null,[[5,9,13,21],[14,,16,20]])},disabled:0===j.length,className:"btn btn-success",type:"button"},r.a.createElement("i",{className:"fas fa-link"}),r.a.createElement("span",{className:"d-none d-sm-inline ml-1"},"Do\u0142\u0105cz")))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-group d-flex justify-content-end"},p&&!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"d-inline-block","data-tip":!0,"data-for":"save-button"},r.a.createElement("button",{className:"btn btn-success",type:"button",disabled:!T(v),onClick:function(){var e,t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(T(v)){a.next=3;break}return alert("Niepoprawne dane"),a.abrupt("return");case 3:return(e=Object(E.a)({},v)).attachments=e.attachments.map((function(e){return S.includes(e.id)?{userName:e.userName,fileName:e.fileName}:e})),t=v.links.find((function(e){return"self"===e.rel})),a.next=8,i.a.awrap(fetch(t.href,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}));case 8:if(a.sent.ok){a.next=12;break}return alert("Nie uda\u0142o si\u0119\xa0zapisa\u0107 zmian"),a.abrupt("return");case 12:s(),c.push("/publications");case 14:case"end":return a.stop()}}))}},"Zapisz"),r.a.createElement(w.a,{id:"save-button",type:"error","data-tip-disable":T(v)},r.a.createElement("span",null,"Nieprawid\u0142owe dane publikacji"))),r.a.createElement("button",{className:"btn btn-danger ml-2",type:"button",onClick:function(){x(o),O([]),b(!1)}},"Anuluj zmiany")),!p&&r.a.createElement("button",{className:"btn btn-info",type:"button",onClick:function(){return b(!0)}},"Edytuj"),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"d-inline-block","data-tip":!0,"data-for":"create-button"},r.a.createElement("button",{className:"btn btn-success",type:"button",disabled:!T(v),onClick:function(){var e,t,a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(T(v)){n.next=3;break}return alert("Niepoprawne dane"),n.abrupt("return");case 3:return e=l.urls.publicationsApi,t=(t=e+l.actions["publication.create"].href).replace("{user}",l.login),a=Object(E.a)({},v),p&&(a.attachments=a.attachments.map((function(e){return{userName:e.userName,fileName:e.fileName}}))),n.next=10,i.a.awrap(fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}));case 10:if(n.sent.ok){n.next=14;break}return alert("Nie uda\u0142o si\u0119\xa0utworzy\u0107 publikacji"),n.abrupt("return");case 14:s(),c.push("/publications");case 16:case"end":return n.stop()}}))}},"Utw\xf3rz pulikacj\u0119")),r.a.createElement(w.a,{id:"create-button",type:"error","data-tip-disable":T(v)},r.a.createElement("span",null,"Nieprawid\u0142owe dane publikacji"))))))})),y=(a(57),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).getActionList=function(){var e,t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(fetch(a.props.urls.publicationsApi));case 2:return e=n.sent,n.next=5,i.a.awrap(e.json());case 5:t=n.sent,a.setState({actions:t._links});case 7:case"end":return n.stop()}}))},a.getCurrentUserLogin=function(){var e,t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=new URL("api/login",a.props.urls.clientBase),r.next=3,i.a.awrap(fetch(e));case 3:return t=r.sent,r.next=6,i.a.awrap(t.text());case 6:return n=r.sent,a.setState({login:n}),r.abrupt("return",n);case 9:case"end":return r.stop()}}))},a.getPublications=function(){var e,t,n,r;return i.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(a.state.actions["publications.list"]){c.next=2;break}return c.abrupt("return");case 2:return a.setState({loadingPublications:!0}),e=(e=a.state.actions["publications.list"].href).replace("{user}",a.state.login),t=new URL(e,a.props.urls.publicationsApi),c.next=8,i.a.awrap(fetch(t));case 8:return n=c.sent,c.next=11,i.a.awrap(n.json());case 11:r=c.sent,a.setState({publications:r,loadingPublications:!1});case 13:case"end":return c.stop()}}))},a.getUserFiles=function(){var e,t,n,r;return i.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return e=new URL("api/jwt/listFiles",a.props.urls.clientBase),c.next=3,i.a.awrap(fetch(e));case 3:return t=c.sent,c.next=6,i.a.awrap(t.json());case 6:return n=c.sent,r=n.token,(e=new URL("/files",a.props.urls.filesApi)).searchParams.set("user",a.state.login),e.searchParams.set("token",r),c.next=13,i.a.awrap(fetch(e));case 13:return t=c.sent,c.next=16,i.a.awrap(t.json());case 16:if(n=c.sent,t.ok){c.next=20;break}return alert("Nie uda\u0142o si\u0119 pobra\u0107 listy Twoich plik\xf3w"),c.abrupt("return");case 20:a.setState({userFiles:n});case 21:case"end":return c.stop()}}))},a.componentDidMount=function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(a.getCurrentUserLogin());case 2:return e.next=4,i.a.awrap(a.getActionList());case 4:a.getPublications(),a.getUserFiles();case 6:case"end":return e.stop()}}))},a.render=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(b.a,null,r.a.createElement(f.b,{path:"/publications",render:function(e){var t=e.match.isExact;return r.a.createElement("section",{className:"container intro d-flex"},!t&&r.a.createElement(b.b,{to:"/publications",onClick:a.getPublications},r.a.createElement("button",{className:"btn btn-warning h-100",style:{width:"6.5ch"}},r.a.createElement("i",{className:"fas fa-chevron-left"}))),r.a.createElement("h1",{className:"mt-2 text-center",style:{flexGrow:1}},"Publikacje"))}}),r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/publications"},r.a.createElement(d,{label:"Twoje publikacje",publications:a.state.publications,refreshPublications:a.getPublications}),r.a.createElement("section",{className:"container"},r.a.createElement("hr",null),a.state.actions["publication.create"]&&r.a.createElement(b.b,{to:"/publications/create"},r.a.createElement("button",{type:"button",className:"btn btn-primary"},"Nowa publikacja")))),r.a.createElement(f.b,{path:"/publications/create"},r.a.createElement(x,{createMode:!0,refreshPublications:a.getPublications,globalState:a.state})),r.a.createElement(f.b,{path:"/publications/:publicationId",render:function(e){var t=a.state.publications.find((function(t){return t.id==e.match.params.publicationId}));return t?r.a.createElement(x,{publication:t,refreshPublications:a.getPublications,globalState:a.state}):r.a.createElement(f.a,{to:"/publications"})}}))))},a.state={login:null,loadingPublications:!1,publications:[],userFiles:[],actions:{},urls:e.urls},a}return Object(p.a)(t,e),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var k={clientBase:document.getElementById("app-url").innerText,filesApi:document.getElementById("file-api-url").innerText,publicationsApi:document.getElementById("publications-api-url").innerText};s.a.render(r.a.createElement(y,{urls:k}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.a3bcf103.chunk.js.map